@model Student
@{
    ViewData["Title"] = "Create Student";
}

<style>
    /* ==== Global ==== */
    .page-header {
        background: linear-gradient(135deg,#6a11cb,#2575fc);
        color: #fff;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.25);
    }

    .card {
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 15px;
        background: #fff;
        box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    .section-title {
        font-weight: 600;
        font-size: 16px;
        color: #444;
        margin-bottom: 8px;
        border-left: 3px solid #6a11cb;
        padding-left: 6px;
    }

    .gradient-box {
        background: linear-gradient(135deg,#ff9a9e,#fad0c4);
        padding: 8px;
        border-radius: 8px;
        margin-bottom: 8px;
        font-weight: 600;
    }

    .form-control, select, textarea {
        border-radius: 6px;
        padding: 6px;
        font-size: 14px;
    }

    .btn {
        border-radius: 6px;
        font-weight: 600;
        padding: 5px 10px;
        font-size: 14px;
    }

    .row.g-2 {
        gap: 8px;
    }
</style>

<div class="page-header">
    <h2><i class="bi bi-person-plus-fill"></i> Create Student</h2>
</div>

<form asp-action="Create" method="post" enctype="multipart/form-data">
    <div asp-validation-summary="All" class="text-danger mb-2"></div>

    <div class="d-flex flex-wrap justify-content-start" style="gap:10px;">

        <!-- ===== Basic Info ===== -->
        <div class="card flex-fill" style="min-width:300px; max-width:480px;">
            <div class="section-title">Basic Info</div>
            <div class="row g-2">
                <div class="col-12 col-md-6">
                    <label asp-for="StudentName">Name (English)</label>
                    <input asp-for="StudentName" class="form-control" placeholder="English" />
                </div>
                <div class="col-12 col-md-6">
                    <label asp-for="ArabicStudentName">Name (Arabic)</label>
                    <input asp-for="ArabicStudentName" class="form-control" placeholder="Arabic" />
                </div>
                <div class="col-12 col-md-6">
                    <label asp-for="BanglaStudentName">Name (Bangla)</label>
                    <input asp-for="BanglaStudentName" class="form-control" placeholder="Bangla" />
                </div>
                <div class="col-12 col-md-6">
                    <label asp-for="RollNo">Roll No</label>
                    <input asp-for="RollNo" class="form-control" />
                </div>
            </div>
        </div>

        <!-- ===== Academic Info ===== -->
        <div class="card flex-fill" style="min-width:300px; max-width:480px;">
            <div class="section-title">Academic Info</div>
            <div class="row g-2">
                <div class="col-12 col-md-6">
                    <label asp-for="DepartmentId">Department</label>
                    <div class="input-group">
                        <select asp-for="DepartmentId" asp-items="ViewBag.DepartmentList" class="form-control">
                            <option value="">-- Select --</option>
                        </select>
                        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#departmentModal">+</button>
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <label asp-for="ClassId">Class</label>
                    <div class="input-group">
                        <select asp-for="ClassId" asp-items="ViewBag.ClassList" class="form-control" id="ClassId">
                            <option value="">-- Select --</option>
                        </select>
                        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#classModal">+</button>
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <label asp-for="SectionId">Section</label>
                    <div class="input-group">
                        <select asp-for="SectionId" asp-items="ViewBag.SectionList" class="form-control" id="SectionId">
                            <option value="">-- Select --</option>
                        </select>
                        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#sectionModal">+</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Personal Info ===== -->
        <div class="card flex-fill" style="min-width:300px; max-width:480px;">
            <div class="section-title">Personal Info</div>
            <div class="row g-2">
                <div class="col-12 col-md-6">
                    <label asp-for="Gender">Gender</label>
                    <select asp-for="Gender" class="form-control">
                        <option value="">Select</option>
                        <option value="0">Male</option>
                        <option value="1">Female</option>
                    </select>
                </div>
                <div class="col-12 col-md-6">
                    <label asp-for="DOB">Date of Birth</label>
                    <input asp-for="DOB" type="date" class="form-control" />
                </div>
                <div class="col-12">
                    <label asp-for="BloodGroup">Blood Group</label>
                    <input asp-for="BloodGroup" class="form-control" />
                </div>
            </div>
        </div>

        <!-- ===== Guardian Info ===== -->
        <div class="card flex-fill" style="min-width:300px; max-width:480px;">
            <div class="section-title">Guardian & Address</div>
            <div class="row g-2">
                <div class="col-12 col-md-6">
                    <label asp-for="GuardianName">Guardian Name</label>
                    <input asp-for="GuardianName" class="form-control" />
                    <label asp-for="GuardianPhone">Phone</label>
                    <input asp-for="GuardianPhone" class="form-control" />
                </div>
                <div class="col-12 col-md-6">
                    <label asp-for="Address">Address</label>
                    <textarea asp-for="Address" class="form-control"></textarea>
                    <label asp-for="City">City</label>
                    <input asp-for="City" class="form-control" />
                </div>
            </div>
        </div>

    </div>

    <!-- ===== Buttons ===== -->
    <div class="d-flex justify-content-end mt-3">
        <button type="submit" class="btn btn-primary px-4">Save Student</button>
    </div>
</form>


<!-- Modals -->
@* Department Modal *@
<div class="modal fade" id="departmentModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Department</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="departmentModalBody">Loading...</div>
        </div>
    </div>
</div>

@* Class Modal *@
<div class="modal fade" id="classModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Class</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="classModalBody">Loading...</div>
        </div>
    </div>
</div>

@* Section Modal *@
<div class="modal fade" id="sectionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Section</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="sectionModalBody">Loading...</div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Modal AJAX Load
        $('#departmentModal').on('show.bs.modal', ()=> $("#departmentModalBody").load('/Department/CreateModal'));
        $('#classModal').on('show.bs.modal', ()=> $("#classModalBody").load('/Class/CreateModal'));
        $('#sectionModal').on('show.bs.modal', ()=> $("#sectionModalBody").load('/Section/CreateModal'));

        // Dropdown cascading
        $("#DepartmentId").change(function() {
            var deptId = $(this).val();
            $.get('/Student/GetClasses', { departmentId: deptId }, function(data) {
                let classDDL = $("#ClassId").empty().append('<option value="">Select Class</option>');
                $.each(data, (_, c) => classDDL.append(`<option value="${c.classId}">${c.className}</option>`));
                $("#SectionId").empty().append('<option value="">Select Section</option>');
            });
        });

        $("#ClassId").change(function() {
            var classId = $(this).val();
            $.get('/Student/GetSections', { classId: classId }, function(data) {
                let secDDL = $("#SectionId").empty().append('<option value="">Select Section</option>');
                $.each(data, (_, s) => secDDL.append(`<option value="${s.sectionId}">${s.sectionName}</option>`));
            });
        });
    </script>
}
