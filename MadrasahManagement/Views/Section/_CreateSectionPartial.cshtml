@model MadrasahManagement.Models.Section

<form id="createSectionModalForm" method="post" asp-action="CreateModalPost">
    @Html.AntiForgeryToken()

    <div class="mb-3">
        <label asp-for="ClassId" class="form-label"></label>
        <select asp-for="ClassId" class="form-select"
                asp-items="@(new SelectList(ViewBag.ClassList, "ClassId", "ClassName"))">
            <option value="">-- Select Class --</option>
        </select>
        <span asp-validation-for="ClassId" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="SectionName" class="form-label"></label>
        <input asp-for="SectionName" class="form-control" />
        <span asp-validation-for="SectionName" class="text-danger"></span>
    </div>

    <div class="text-end">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Save</button>
    </div>
</form>

@section Scripts {
    <script>
        $(function() {
            // unobtrusive validation bind
            $.validator.unobtrusive.parse('#createSectionModalForm');

            $('#createSectionModalForm').on('submit', function (e) {
                e.preventDefault();

                var $form = $(this);
                var url = $form.attr('action');

                // read antiforgery token from the form
                var token = $form.find('input[name="__RequestVerificationToken"]').val();

                // form data
                var data = $form.serialize();

                $.ajax({
                    url: url,
                    type: 'POST',
                    data: data,
                    headers: {
                        'RequestVerificationToken': token // sometimes automatic, but ensure included
                    },
                    success: function (resp) {
                        if (resp && resp.success) {
                            // close modal
                            $('#classModal').modal('hide'); // adjust modal id if needed

                            // refresh section page dropdown (the parent page)
                            if (typeof RefreshClassList === 'function') {
                                RefreshClassList();
                            }
                        } else {
                            // show errors - if server returns validation messages
                            // optionally replace modal body with the returned HTML
                            if (resp && resp.html) {
                                $('#classModalBody').html(resp.html);
                                $.validator.unobtrusive.parse('#createSectionModalForm');
                            } else {
                                alert('Save failed. Check input.');
                            }
                        }
                    },
                    error: function (xhr) {
                        console.error('AJAX error', xhr);
                        alert('Something went wrong. See console.');
                    }
                });

            });
        });
    </script>
}
